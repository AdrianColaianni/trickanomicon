\documentclass[12pt,letterpaper]{article}
\usepackage[margin=1in]{geometry}


% Font w/ xelatex
\ifxetex
	\usepackage{fontspec}
	\setsansfont{Jost.ttf}[
	BoldFont = Jost-Bold.ttf ,
	ItalicFont = Jost-Italic.ttf ,
	BoldItalicFont = Jost-BoldItalic.ttf]
	\renewcommand{\familydefault}{\sfdefault}
	\setmonofont{FiraCode Nerd Font}
\else
	\renewcommand{\familydefault}{\sfdefault}
\fi

% Quotes
\usepackage[american]{babel}

% Rose Pine
\usepackage{xcolor}
\definecolor{fg}{HTML}{e0def4}
\definecolor{bg}{HTML}{232136}
\definecolor{c0}{HTML}{393552}
\definecolor{c1}{HTML}{eb6f92}
\definecolor{c2}{HTML}{9ccfd8}
\definecolor{c3}{HTML}{f6c177}
\definecolor{c4}{HTML}{3e8fb0}
\definecolor{c5}{HTML}{c4a7e7}
\definecolor{c6}{HTML}{ea9a97}
\definecolor{c7}{HTML}{e0def4}
\definecolor{c8}{HTML}{6e6a86}
\pagecolor{bg}
\color{fg}

% Images
% \usepackage{graphicx}
% \usepackage{wrapfig}
% \usepackage{float}

% \usepackage{pgfplots}
% \usepackage{multicol}
% \usepackage{lipsum}

% Set list numbering
\renewcommand{\labelenumii}{\arabic{enumi}.\arabic{enumii}}
\renewcommand{\labelenumiii}{\arabic{enumi}.\arabic{enumii}.\arabic{enumiii}}
\renewcommand{\labelenumiv}{\arabic{enumi}.\arabic{enumii}.\arabic{enumiii}.\arabic{enumiv}}

\def\code#1{\textcolor{c2}{\texttt{#1}}}
\def\bf#1{\textbf{#1}}
\def\ul#1{\underline{#1}}
\def\it#1{\textit{#1}}

% Links
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=c4,
    filecolor=magenta,
    urlcolor=blue,
}

\title{\huge{\textit{Trickanomicon}}}
\author{Clemson CCDC Team}
\date{2024}

\begin{document}

\maketitle

\pagebreak

\tableofcontents

\pagebreak

\section{Linux}

\bf{Do not touch the} \code{seccdc\_black} \bf{account}

\subsection{30 Minute Plan}

\begin{enumerate}
	\item Rotate all ssh keys
		\begin{enumerate}
			\item Generate the ssh key from Adrian
			\item Deploy with \code{\bf{ssh-copy-id -i} \ul{identity\_file} [\ul{user}\@\ul{hostname}]}
			\item Remove all other authorized keys with \code{find / -name authorized\_keys}
		\end{enumerate}
	\item Check accounts and reset password \bf{ASAP}
	\item Lock unnecessary accounts with \code{\bf{usermod -L} \ul{LOGIN}} and if nothing goes red, delete account with \code{\bf{userdel -r} \ul{LOGIN}}
	\item Find listening services with \code{ss -lp} and investigate strange ones
\end{enumerate}

\subsection{Monitoring}

\begin{enumerate}
	\item View all network connections \code{ss -tunlp}
	\item View listening programs with \code{ss -lp}
	\item View only connections with \code{ss -tu}
	\item View active processes \code{ps -e}
	\item Continuously see processes with \code{top}
		\begin{enumerate}
			\item Sort by different categories with \code{<} and \code{>}
			\item Tree view with \code{V}
		\end{enumerate}
	\item Watch \bf{all} network traffic with the following (this is a fire hose)
		\begin{enumerate}
			\item Record traffic with \code{iptables -I INPUT -j LOG}
			\item Watch logs with \code{journalctl -kf --grep="IN=.*"}
		\end{enumerate}
	\item Watch dbus with \code{dbus -w}
\end{enumerate}

\subsection{System Utilities}

\begin{enumerate}
	\item Start and stop processes with \code{systemctl}
	\begin{enumerate}
		\item Start service with \code{\bf{systemctl start} [\ul{UNIT}]}
		\item Stop service with \code{\bf{systemctl stop} [\ul{UNIT}]}
		\item Restart service with \code{\bf{systemctl restart} [\ul{UNIT}]}
		\item Enable service with \code{\bf{systemctl enable} [\ul{UNIT}]}
	\end{enumerate}
	\item Permit and allow network connections with \code{iptables}
	\begin{enumerate}
		\item Default deny with \code{iptables -P INPUT DROP}
		\item Allow port access (must choose tcp or udp) \\
			\code{\bf{iptables -A INPUT -p tcp|udp --dport} \ul{port} \bf{-j ACCEPT}}
		\item Allow all from interface \\
			\code{\bf{iptables -A INPUT -i} \ul{interface} \bf{-j ACCEPT}}
	\end{enumerate}
	\item Schedule tasks with cron
	\begin{enumerate}
		\item View with \code{crontab -e}
		\item Obliterate user's crontab with \code{crontab -r}
	\end{enumerate}
	\item View networking information with \code{ip}
		\begin{enumerate}
			\item View network interfaces with \code{ip l}
				\begin{enumerate}
					\item Interfaces are prefixed with an \code{en} to signify ethernet, \code{wl} to signify wireless, and \code{v} to signify a virtual link
					\item Virtual links should be investigated, as they are commonly used for VPNs, docker, and nonsense
					\item Virtual servers will still show their main link to the host as ethernet
				\end{enumerate}
			\item View IP Addresses with \code{ip a} and take note of additional addresses
		\end{enumerate}
\end{enumerate}

\subsection{Configurations}

\begin{enumerate}
	\item SSH Daemon configs are in \code{/etc/ssh/sshd\_config}
		\begin{enumerate}
			\item \code{PermitRootLogin} should be set to \code{prohibit-password}
			\item \code{UsePAM} should be set to \code{no}
			\item \code{PasswordAuthentication} should be set to \code{yes}
			\item \code{PermitEmptyPasswords} should be set to \code{no}
		\end{enumerate}
	\item File system configs are in \code{/etc/fstab}
		\begin{enumerate}
			\item Network File Shares are in the form \\
				\code{/srv/home    hostname1(rw,sync,no\_subtree\_check)} \\
				These allow sharing file systems over the network.  They must be reviewed to ensure we are not sharing information with attackers
		\end{enumerate}
\end{enumerate}

\subsection{Hunting}

\begin{enumerate}
	\item List all files with creation date, most recent first: \code{find /usr /bin /etc /var -type f -exec stat -c "\%W \%n" {} + | sort -r > files}
	\item List all files created after set date, most recent first: \code{find /usr /bin /etc /var -type f -newermt \ul{YYYY-MM-DD} -exec stat -c "\%W \%n" {} + | sort -r > files}
\end{enumerate}

\subsection{Duncan's Magic}

\begin{enumerate}
	\item Remove users listed in disable.txt \\
		\code{while read user;do sudo usermod -L \$user;done<disable.txt}
	\item Reset password from ./users.txt AND output updated passwords to ./changed\_passwords.txt (make sure no ./changed\_passwords.txt exists in directory before hand) \\
		\code{name='NAME HERE' while read user; do password=`tr -dc 'A-Za-z0-9!@\#\$\%' </dev/urandom | head -c 24; echo`; echo "\$name,\$user,\$password" >> changed\_passwords.txt; echo "\$user:\$password" | sudo chpasswd; done < users.txt}
	\item Find users not in ./known\_users.txt \\
		\code{awk -F: '\{if(\$3>=1000\&\&\$3<60000)\{print \$1\}\}' /etc/passwd|sort|comm -13 known\_users.txt ->extra\_users.txt}
\end{enumerate}

\end{document}
